<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>ç®€è®°â€”â€”Tensorflow2è¿›é˜¶çŸ¥è¯†ä¸‹ â€“ ç¿°æ—æœ¨å­çš„ç¬”è®°æœ¬</title>
<meta name="description" content="å‰è¨€ ä¸Šç¯‡ï¼Œç®€å•è®°å½•äº†ä¸‹TFæ˜“ç†è§£çš„æ“ä½œå‡½æ•°ï¼Œä¸‹é¢è®°å½•ä¸€ä¸‹ç¨éš¾ä¸€äº›çš„åŠŸèƒ½å‡½æ•°ã€‚ åŒæ ·çš„ï¼Œæˆ‘ä»ç„¶æ˜¯è‡ªå·±ç†è§£ï¼‹å¤åˆ¶ã€ŠTensorflowæ·±åº¦å­¦ä¹ ã€‹è¿™ä¹¦çš„å†…å®¹åšä¸€ä¸ªç®€å•çš„è®°å½•ã€‚ä¸»è¦æ˜¯æ–¹ä¾¿è‡ªå·±ä»¥åéœ€è¦çš„æ—¶å€™çœ‹ä¸€ä¸‹ â€¦">
<meta name="keywords" content="Tensorflow">
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//cdn.staticfile.org">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="dns-prefetch" href="//zz.bdstatic.com">
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.7.2" type="text/css" media="all">
<style id="md-style-inline-css" type="text/css">.copy-button { cursor: pointer; border: 0; font-size: 12px; text-transform: uppercase; font-weight: 500; padding: 3px 6px 3px 6px; background-color: rgba(255, 255, 255, 0.6); position: absolute; overflow: hidden; top: 5px; right: 5px; border-radius: 3px; } .copy-button:before { content: ""; display: inline-block; width: 16px; height: 16px; margin-right: 3px; background-size: contain; background-image: url("data:image/svg+xml,%3Csvg version=\'1.1\' xmlns=\'http://www.w3.org/2000/svg\' xmlns:xlink=\'http://www.w3.org/1999/xlink\' x=\'0px\' y=\'0px\' width=\'16px\' height=\'16px\' viewBox=\'888 888 16 16\' enable-background=\'new 888 888 16 16\' xml:space=\'preserve\'%3E %3Cpath fill=\'%23333333\' d=\'M903.143,891.429c0.238,0,0.44,0.083,0.607,0.25c0.167,0.167,0.25,0.369,0.25,0.607v10.857 c0,0.238-0.083,0.44-0.25,0.607s-0.369,0.25-0.607,0.25h-8.571c-0.238,0-0.44-0.083-0.607-0.25s-0.25-0.369-0.25-0.607v-2.571 h-4.857c-0.238,0-0.44-0.083-0.607-0.25s-0.25-0.369-0.25-0.607v-6c0-0.238,0.06-0.5,0.179-0.786s0.262-0.512,0.428-0.679 l3.643-3.643c0.167-0.167,0.393-0.309,0.679-0.428s0.547-0.179,0.786-0.179h3.714c0.238,0,0.44,0.083,0.607,0.25 c0.166,0.167,0.25,0.369,0.25,0.607v2.929c0.404-0.238,0.785-0.357,1.143-0.357H903.143z M898.286,893.331l-2.67,2.669h2.67V893.331 z M892.571,889.902l-2.669,2.669h2.669V889.902z M894.321,895.679l2.821-2.822v-3.714h-3.428v3.714c0,0.238-0.083,0.441-0.25,0.607 s-0.369,0.25-0.607,0.25h-3.714v5.714h4.571v-2.286c0-0.238,0.06-0.5,0.179-0.786C894.012,896.071,894.155,895.845,894.321,895.679z M902.857,902.857v-10.286h-3.429v3.714c0,0.238-0.083,0.441-0.25,0.607c-0.167,0.167-0.369,0.25-0.607,0.25h-3.714v5.715H902.857z\' /%3E %3C/svg%3E"); background-repeat: no-repeat; position: relative; top: 3px; } pre { position: relative; } pre:hover .copy-button { background-color: rgba(255, 255, 255, 0.9); }</style>
<link rel="stylesheet" id="fancybox-css" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="style-css" href="/wp-content/themes/sweet/static/css/sweet.css?ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="prism-css-0-css" href="https://cdn.jsdelivr.net/npm/prismjs@1.15.0/themes/prism.css?ver=1.15.0" type="text/css" media="all">
<link rel="stylesheet" id="prism-css-1-css" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.css?ver=1.15.0" type="text/css" media="all">
<link rel="stylesheet" id="emojify-css" href="https://cdn.jsdelivr.net/npm/emojify.js@1.1.0/dist/css/basic/emojify.min.css?ver=1.1.0" type="text/css" media="all">
<script type="text/javascript" src="/wp-includes/js/jquery/jquery.min.js?ver=3.5.1" id="jquery-core-js"></script>
<script type="text/javascript" src="/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2" id="jquery-migrate-js"></script>
<script type="text/javascript" src="/wp-content/themes/sweet/static/js/sweet.js?ver=5.7.2" id="sweet-js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js?ver=5.7.2" id="fancybox-js"></script>

<link href="/wp-content/uploads/2021/07/1617196601-favicon-32x32-1.png" rel="shortcut icon" type="image/x-icon">
<link href="/wp-content/uploads/2021/07/1617196599-apple-touch-icon.png" rel="apple-touch-icon">
<script type="text/javascript">

</script>
<style type="text/css"></style>
	
	</head>

<body class="post-template-default single single-post postid-82 single-format-standard">


<div class="navbar w-nav">
	<div class="container w-container">
				<a class="logo-block w-inline-block" href="/">
			<img class="logo" src="/wp-content/uploads/2021/07/1617196599-apple-touch-icon.png">
		</a>
				<nav class="nav-menu w-nav-menu">
			<li id="menu-item-97" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97"><a href="https://ytlee.cn/">é¦–é¡µ</a></li>
<li id="menu-item-99" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-99"><a href="/category/note/">ç¬”è®°æœ¬</a></li>
<li id="menu-item-100" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-100"><a href="/category/draft/">è‰ç¨¿æœ¬</a></li>
<li id="menu-item-103" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-103"><a href="/about-me/">å…³äºæˆ‘</a></li>
					</nav>
		<div class="menu-button w-nav-button">
			<div class="w-icon-nav-menu right">
			</div>
		</div>
		<div class="rightNav">
			<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97"><a href="https://ytlee.cn/">é¦–é¡µ</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-99"><a href="/category/note/">ç¬”è®°æœ¬</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-100"><a href="/category/draft/">è‰ç¨¿æœ¬</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-103"><a href="/about-me/">å…³äºæˆ‘</a></li>
		</div>
	</div>
</div>
<div class="bgDiv"></div>

<div class="blog-header">
	<div class="blog-header-overlay"></div>
	<div class="header-image-block" style="background-image: url('/wp-content/uploads/2021/07/stock-photo-1025332216.jpg.pagespeed.ce_.mjMOy05gAM.jpg');"></div>
</div>
<div class="blog-post-section section">
	<div class="blog-post-container container w-container">
		<div class="white-content-block">
			<div class="blog-post-image-block" style="background-image: url('/wp-content/uploads/2021/07/stock-photo-1028570973.jpg.pagespeed.ce_.yHsR8V6ibP.jpg');">
				<a href="/category/note/" rel="category tag">ç¬”è®°æœ¬</a>				<div class="blog-post-header">
					<div class="blog-header-title-wrapper">
						<div class="blog-post-date">2020-08-21</div>
						<h1 class="blog-post-title">ç®€è®°â€”â€”Tensorflow2è¿›é˜¶çŸ¥è¯†ä¸‹</h1>
					</div>
				</div>
			</div>
			<div class="align-left white-content-block-content-wrapper">
				<div class="rich-text-block w-richtext">
					<h2>
<a name="toc-1"></a>å‰è¨€</h2>
<p>ä¸Šç¯‡ï¼Œç®€å•è®°å½•äº†ä¸‹TFæ˜“ç†è§£çš„æ“ä½œå‡½æ•°ï¼Œä¸‹é¢è®°å½•ä¸€ä¸‹ç¨éš¾ä¸€äº›çš„åŠŸèƒ½å‡½æ•°ã€‚</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»ç„¶æ˜¯è‡ªå·±ç†è§£ï¼‹å¤åˆ¶ã€ŠTensorflowæ·±åº¦å­¦ä¹ ã€‹è¿™ä¹¦çš„å†…å®¹åšä¸€ä¸ªç®€å•çš„è®°å½•ã€‚ä¸»è¦æ˜¯æ–¹ä¾¿è‡ªå·±ä»¥åéœ€è¦çš„æ—¶å€™çœ‹ä¸€ä¸‹ï¼Œè‹¥æœ‰ç¼˜è¢«ä»–äººæ‰€è§ï¼Œèƒ½å¸®åˆ°åˆ«äººä¹Ÿæ˜¯æå¥½çš„ã€‚</p>
<h2>
<a name="toc-2"></a>é«˜çº§æ“ä½œ</h2>
<h3>
<a name="toc-3"></a>tf.gather</h3>
<p>è¯¥å‡½æ•°æ˜¯åˆ©ç”¨æ•°æ®çš„ç´¢å¼•å·æ¥æ”¶é›†æ•°æ®ã€‚æœ¬æ¥åˆ‡ç‰‡ä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œä½†æ˜¯å¯¹äºå¤æ‚åœºæ™¯ï¼Œåˆ‡ç‰‡å°†ä¼šååˆ†ç¹çï¼Œè€Œtf.gatherå¾ˆç®€å•ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¯¹äºæˆç»©å†Œçš„ä¾‹å­ï¼Œ4ä¸ªç­ï¼Œ35ä¸ªå­¦ç”Ÿæ¯ä¸ªç­ï¼Œæ¯å­¦ç”Ÿ8é—¨è¯¾ã€‚åˆ™æˆç»©å†Œçš„å¼ é‡shapeä¸º[4,35,8]ã€‚å¦‚æœæˆ‘ä»¬è¦è¯»å–ã€2ï¼Œ3ã€‘ç­ã€3ï¼Œ4ï¼Œ6ï¼Œ27ã€‘å·åŒå­¦çš„ç§‘ç›®ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<h5>ç¤ºä¾‹ä»£ç </h5>
<pre><code class="language-python">import tensorflow as tf

x = tf.random.uniform([4, 35, 8], maxval=100, dtype=tf.int32)  # æˆç»©å†Œå¼ é‡\
students = tf.gather(x, [1, 2], axis=0)  # æ”¶é›†ç¬¬ 2,3 å·ç­çº§
degree = tf.gather(students, [2, 3, 5, 26], axis=1)  # æ”¶é›†ç¬¬ 3,4,6,27 å·åŒå­¦
print(degree)
Outï¼š
tf.Tensor(
[[[79 38 36 79 85 51 72 60]
  [26 56 42 84 90 66  1 84]
  [26 32 33 53 90 44 70 69]
  [ 5 79 58 87 43 45 12 87]]

 [[69 37  8 54 58  2 54 17]
  [25 87 94 83 27 68 31 14]
  [89 73 99 48 23 75 18 59]
  [37 17 60 75 50 77 42 56]]], shape=(2, 4, 8), dtype=int32)</code></pre>
<h3>
<a name="toc-4"></a>tf.gather_nd</h3>
<p>å½“æˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªç»´åº¦æ— è§„å¾‹é‡‡æ ·æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åæ ‡çš„æ–¹å¼ï¼Œæ¯æ¬¡é‡‡æ ·ä¸€ä¸ªç‚¹ï¼Œç„¶åå°†è¿™äº›ç‚¹å †å æˆ–è€…æ’åˆ—èµ·æ¥ã€‚</p>
<p>tf.gather_nd å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šæ¯æ¬¡é‡‡æ ·ç‚¹çš„å¤šç»´åæ ‡æ¥å®ç°é‡‡æ ·å¤šä¸ªç‚¹çš„ç›® çš„ã€‚å½“æˆ‘ä»¬å¸Œæœ›æŠ½æŸ¥ç¬¬ 2 ä¸ªç­çº§çš„ç¬¬ 2 ä¸ªåŒå­¦çš„æ‰€æœ‰ç§‘ç›®ï¼Œç¬¬ 3 ä¸ªç­çº§çš„ ç¬¬ 3 ä¸ªåŒå­¦çš„æ‰€æœ‰ç§‘ç›®ï¼Œç¬¬ 4 ä¸ªç­çº§çš„ç¬¬ 4 ä¸ªåŒå­¦çš„æ‰€æœ‰ç§‘ç›®æˆç»©çš„æ—¶å€™ã€‚å¯ä»¥å°†è¿™äº›ç‚¹åˆå¹¶æˆä¸€ä¸ªListå‚æ•°ï¼Œç„¶åç”¨tf.gather_ndé‡‡æ ·ã€‚</p>
<h5>ç¤ºä¾‹ä»£ç </h5>
<pre><code class="language-python">import tensorflow as tf

x = tf.random.uniform([4, 35, 8], maxval=100, dtype=tf.int32)  # æˆç»©å†Œå¼ é‡\
tmp = [[1, 1], [2, 2], [3, 3]]
degree = tf.gather_nd(x,tmp)
print(degree)

Outï¼š
tf.Tensor(
[[41 98 37 93 29  9 53 30]
 [77 32 79 51 44 56  0 15]
 [83 62 33 45 29 39 54 37]], shape=(3, 8), dtype=int32)</code></pre>
<h3>
<a name="toc-5"></a>tf.boolean_mask</h3>
<p>maskï¼Œæ©è†œã€‚å‡½æ•°tf.boolean_mask(x, mask, axis)åœ¨axisè½´ä»¥ç‰¹å®šçš„æ©è†œé‡‡æ ·æ•°æ®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>æ©è†œçš„é•¿åº¦å¿…é¡»ä¸æå–ç»´åº¦çš„é•¿åº¦ä¸€è‡´ã€‚</strong></p>
<h5>ç¤ºä¾‹ä»£ç 1</h5>
<p>åœ¨ä¸Šè¿°æˆç»©å†Œç¤ºä¾‹ä¸­ï¼Œåˆ©ç”¨æ©è†œé‡‡æ ·4ç»„æ•°æ®ã€‚</p>
<pre><code class="language-python">import tensorflow as tf

x = tf.random.uniform([4, 35, 8], maxval=100, dtype=tf.int32)  # æˆç»©å†Œå¼ é‡\
degree = tf.boolean_mask(
    x, mask=[True, False, True, False, True, False, True, False],axis=2)
print(degree)</code></pre>
<p>å¦‚ä¸Šä»£ç ï¼Œå¯ä»¥å‘ç°tf.boolean_maskä¸tf.gatherçš„ç”¨æ³•ç±»ä¼¼</p>
<h5>ç¤ºä¾‹ä»£ç 2</h5>
<p>é‡‡æ ·å¤šç»´æ•°æ®ï¼Œæ€ä¹ˆåŠå‘¢?å’Œtf.gather_ndç±»ä¼¼ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤šç»´çš„æ©è†œåˆ—è¡¨å³å¯ã€‚</p>
<pre><code class="language-python">import tensorflow as tf

x = tf.random.uniform([2, 3, 8], maxval=100, dtype=tf.int32)  # æˆç»©å†Œå¼ é‡\
degree = tf.boolean_mask(
    x, mask=[[True, False, False], [True, True, False]])
print(degree)

Out:
tf.Tensor(
[[96 31 97 34 73 95 77 65]
 [83 16 17 99 32 44 85 35]
 [ 7 40 20  3 76 40 13 31]], shape=(3, 8), dtype=int32)</code></pre>
<h3>
<a name="toc-6"></a>tf.where</h3>
<p>é€šè¿‡ tf.where(cond, a, b)æ“ä½œå¯ä»¥æ ¹æ® cond æ¡ä»¶çš„çœŸå‡ä»å‚æ•°ğ‘¨æˆ–ğ‘©ä¸­è¯»å–æ•°æ®ã€‚</p>
<ul>
<li>condã€Aã€Bçš„shapeæ˜¯ä¸€æ ·çš„</li>
<li>cond(i)è¡¨ç¤ºç¬¬iå·ç´¢å¼•å¤„çš„æ•°æ®</li>
<li>å½“cond(i)=Trueæ—¶ï¼Œé‡‡æ ·a(i)ï¼›å½“cond(i)=Falseæ—¶ï¼Œé‡‡æ ·a=b(i)ã€‚</li>
</ul>
<h5>ç¤ºä¾‹ä»£ç 1</h5>
<pre><code class="language-python">import tensorflow as tf

a = tf.ones([3, 3])
b = tf.zeros([3, 3])
cond = tf.constant([[True, False, False], [False, True, False], [False, False, True]])
result = tf.where(cond, a, b)
print(result)

Out:
tf.Tensor(
[[1. 0. 0.]
 [0. 1. 0.]
 [0. 0. 1.]], shape=(3, 3), dtype=float32)</code></pre>
<ul>
<li><strong>å½“å‚æ•°a,bä¸æŒ‡å®šæ—¶ï¼Œè¿”å›condä¸­æ‰€æœ‰Trueçš„ç´¢å¼•åæ ‡</strong></li>
</ul>
<h5>ç¤ºä¾‹ä»£ç 2</h5>
<pre><code class="language-python">import tensorflow as tf

a = tf.ones([3, 3])
b = tf.zeros([3, 3])
cond = tf.constant([[True, False, False], [False, True, False], [False, False, True]])
result = tf.where(cond)
print(result)

Out:
tf.Tensor(
[[0 0]
 [1 1]
 [2 2]], shape=(3, 2), dtype=int64)</code></pre>
<h5>ç¤ºä¾‹ä»£ç 3â€”â€”æå–æ­£æ•°æ•°æ®åŠç´¢å¼•</h5>
<pre><code class="language-python">import tensorflow as tf

x = tf.random.normal([3,3])
mask = tf.math.greater(x,0)
print(mask)
indices = tf.where(mask)
print(indices)
data = tf.gather_nd(x,indices)
print(data)

Out:
tf.Tensor(
[[False  True  True]
 [False False False]
 [ True  True  True]], shape=(3, 3), dtype=bool)

tf.Tensor(
[[0 1]
 [0 2]
 [2 0]
 [2 1]
 [2 2]], shape=(5, 2), dtype=int64)

tf.Tensor([0.01925842 1.841275   0.23401627 0.9247126  2.4403362 ], shape=(5,), dtype=float32)</code></pre>
<h3>
<a name="toc-7"></a>tf.scatter_nd</h3>
<p>é€šè¿‡ tf.scatter_nd(indices, updates, shape)å‡½æ•°å¯ä»¥é«˜æ•ˆåœ°åˆ·æ–°å¼ é‡çš„éƒ¨åˆ†æ•°æ®ï¼Œä½†æ˜¯è¿™ ä¸ªå‡½æ•°åªèƒ½åœ¨å…¨ 0 çš„ç™½æ¿å¼ é‡ä¸Šé¢æ‰§è¡Œåˆ·æ–°æ“ä½œï¼Œå› æ­¤å¯èƒ½éœ€è¦ç»“åˆå…¶å®ƒæ“ä½œæ¥å®ç°ç°æœ‰å¼ é‡çš„æ•°æ®åˆ·æ–°åŠŸèƒ½ã€‚</p>
<p>å·æ‡’äº†...</p>
<p>åŸä¹¦P113.</p>
<h3>
<a name="toc-8"></a>meshgrid</h3>
<p>é€šè¿‡ tf.meshgrid å‡½æ•°å¯ä»¥æ–¹ä¾¿åœ°ç”ŸæˆäºŒç»´ç½‘æ ¼çš„é‡‡æ ·ç‚¹åæ ‡ï¼Œæ–¹ä¾¿å¯è§†åŒ–ç­‰åº”ç”¨åœº åˆã€‚</p>
<p>åŸä¹¦P115</p>
<h2>
<a name="toc-9"></a>ç»å…¸æ•°æ®é›†åŠ è½½</h2>
<p>åœ¨ TensorFlowä¸­ï¼Œkeras.datasets æ¨¡å—æä¾›äº†å¸¸ç”¨ç»å…¸æ•°æ®é›†çš„è‡ªåŠ¨ä¸‹è½½ã€ç®¡ç†ã€åŠ è½½ ä¸è½¬æ¢åŠŸèƒ½ï¼Œå¹¶ä¸”<strong>æä¾›äº† tf.data.Dataset æ•°æ®é›†å¯¹è±¡</strong>ï¼Œæ–¹ä¾¿å®ç°å¤šçº¿ç¨‹(Multi-threading)ã€é¢„å¤„ç†(Preprocessing)ã€éšæœºæ‰“æ•£(Shuffle)å’Œæ‰¹è®­ç»ƒ(Training on Batch)ç­‰å¸¸ç”¨æ•°æ®é›†çš„åŠŸèƒ½ã€‚</p>
<p><strong>é€šè¿‡ datasets.xxx.load_data()å‡½æ•°å³å¯å®ç°ç»å…¸æ•°æ®é›†çš„è‡ªåŠ¨åŠ è½½</strong>ï¼Œå…¶ä¸­ xxx ä»£è¡¨å…·ä½“ çš„æ•°æ®é›†åç§°ï¼Œå¦‚â€œCIFAR10â€ã€â€œMNISTâ€ã€‚TensorFlowä¼šé»˜è®¤å°†æ•°æ®ç¼“å­˜åœ¨ç”¨æˆ·ç›®å½•ä¸‹ çš„.keras/datasets æ–‡ä»¶å¤¹ï¼Œç”¨æˆ·ä¸éœ€è¦å…³å¿ƒæ•°æ®é›†æ˜¯å¦‚ä½•ä¿å­˜çš„ã€‚å¦‚æœå½“å‰ æ•°æ®é›†ä¸åœ¨ç¼“å­˜ä¸­ï¼Œåˆ™ä¼šè‡ªåŠ¨ä»ç½‘ç»œä¸‹è½½ã€è§£å‹å’ŒåŠ è½½æ•°æ®é›†ï¼›å¦‚æœå·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œåˆ™è‡ª<br>
åŠ¨å®ŒæˆåŠ è½½ã€‚</p>
<h5>ç¤ºä¾‹ä»£ç â€”â€”åŠ è½½MNISTæ•°æ®é›†</h5>
<pre><code class="language-python">import tensorflow as tf

from tensorflow import keras
from tensorflow.keras import datasets

# load mnist
(x, y), (x_test, y_test) = datasets.mnist.load_data()
print('x:', x.shape, 'y:', y.shape, 'x test:', x_test.shape, 'y test:', y_test)

Outï¼š
x: (60000, 28, 28) y: (60000,) x test: (10000, 28, 28) y test: [7 2 1 ... 4 5 6]</code></pre>
<ul>
<li>load_data()å¾—åˆ°çš„æ˜¯ä¸¤ä¸ªå…ƒç»„</li>
<li>ä¸ºä½¿ç”¨tensorflowæä¾›çš„ä¾¿æ·åŠŸèƒ½ï¼Œéœ€è¦å°†æ•°æ®è½¬æ¢æˆDatasetå¯¹è±¡</li>
<li>é€šè¿‡Dataset.from_tensor_slices å¯ä»¥å°†è®­ç»ƒéƒ¨åˆ†çš„æ•°æ®å›¾ç‰‡ x å’Œæ ‡ç­¾ y éƒ½è½¬æ¢æˆ Dataset å¯¹è±¡ã€</li>
</ul>
<pre><code class="language-python">train_db = tf.data.Dataset.from_tensor_slices((x, y)) # æ„å»º Dataset å¯¹è±¡</code></pre>
<h3>
<a name="toc-10"></a>éšæœºæ‰“æ•£</h3>
<p>é€šè¿‡Dataset.shuffle(buffer_size)å·¥å…·å¯ä»¥è®¾ç½®Dataset å¯¹è±¡éšæœºæ‰“æ•£æ•°æ®ä¹‹é—´çš„é¡ºåºï¼Œ é˜²æ­¢æ¯æ¬¡è®­ç»ƒæ—¶æ•°æ®æŒ‰å›ºå®šé¡ºåºäº§ç”Ÿã€‚</p>
<pre><code class="language-python">train_db = train_db.shuffle(10000) # éšæœºæ‰“æ•£æ ·æœ¬ï¼Œä¸ä¼šæ‰“ä¹±æ ·æœ¬ä¸æ ‡ç­¾æ˜ å°„å…³ç³»</code></pre>
<h3>
<a name="toc-11"></a>æ‰¹è®­ç»ƒ</h3>
<p>ä¸ºäº†åˆ©ç”¨æ˜¾å¡çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œä¸€èˆ¬åœ¨ç½‘ç»œçš„è®¡ç®—è¿‡ç¨‹ä¸­ä¼šåŒæ—¶è®¡ç®—å¤šä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬ æŠŠè¿™ç§è®­ç»ƒæ–¹å¼å«åšæ‰¹è®­ç»ƒï¼Œå…¶ä¸­ä¸€ä¸ªæ‰¹ä¸­æ ·æœ¬çš„æ•°é‡å«åšBatch Sizeã€‚</p>
<pre><code class="language-python">train_db = train_db.batch(64)  # è®¾ç½®æ‰¹è®­ç»ƒçš„å¤§å°</code></pre>
<p>å…¶ä¸­ 128 ä¸ºBatch Size å‚æ•°ï¼Œå³ä¸€æ¬¡å¹¶è¡Œè®¡ç®— 128 ä¸ªæ ·æœ¬çš„æ•°æ®ã€‚Batch Size ä¸€èˆ¬æ ¹æ®ç”¨æˆ· çš„GPUæ˜¾å­˜èµ„æºæ¥è®¾ç½®ï¼Œå½“æ˜¾å­˜ä¸è¶³æ—¶ï¼Œå¯ä»¥é€‚é‡å‡å°‘ Batch Size æ¥å‡å°‘ç®—æ³•çš„æ˜¾å­˜ä½¿ç”¨é‡ã€‚</p>
<h3>
<a name="toc-12"></a>é¢„å¤„ç†</h3>
<p>ä» keras.datasets ä¸­åŠ è½½çš„æ•°æ®é›†çš„æ ¼å¼å¤§éƒ¨åˆ†æƒ…å†µéƒ½ä¸èƒ½ç›´æ¥æ»¡è¶³æ¨¡å‹çš„è¾“å…¥è¦æ±‚ï¼Œ å› æ­¤éœ€è¦æ ¹æ®ç”¨æˆ·çš„é€»è¾‘è‡ªè¡Œå®ç°é¢„å¤„ç†æ­¥éª¤ã€‚Dataset å¯¹è±¡é€šè¿‡æä¾›map(func)å·¥å…·å‡½æ•°ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„é¢„å¤„ç†é€»è¾‘ï¼Œå®ƒå®ç°åœ¨ func å‡½æ•°é‡Œã€‚</p>
<p>ä¾‹å¦‚è°ƒç”¨é¢„å¤„ç†å‡½æ•°ï¼š</p>
<pre><code class="language-python">train_db = train_db.map(preprocess)</code></pre>
<h3>
<a name="toc-13"></a>å¾ªç¯è®­ç»ƒ</h3>
<p>å½“å¯¹ train_db çš„æ‰€æœ‰æ ·æœ¬å®Œ æˆä¸€æ¬¡è¿­ä»£åï¼Œfor å¾ªç¯ç»ˆæ­¢é€€å‡ºã€‚è¿™æ ·å®Œæˆä¸€ä¸ªBatch çš„æ•°æ®è®­ç»ƒï¼Œå«åšä¸€ä¸ª Stepï¼›é€šè¿‡ å¤šä¸ª step æ¥å®Œæˆæ•´ä¸ªè®­ç»ƒé›†çš„ä¸€æ¬¡è¿­ä»£ï¼Œå«åšä¸€ä¸ª Epochã€‚åœ¨å®é™…è®­ç»ƒæ—¶ï¼Œé€šå¸¸éœ€è¦å¯¹æ•°<br>
æ®é›†è¿­ä»£å¤šä¸ª Epoch æ‰èƒ½å–å¾—è¾ƒå¥½åœ°è®­ç»ƒæ•ˆæœã€‚</p>
<pre><code class="language-python">for epoch in range(20): # è®­ç»ƒ Epoch æ•° 
    for step, (x,y) in enumerate(train_db): # è¿­ä»£ Step æ•°
        # training...</code></pre>
									</div>
				<div class="blog-author-block w-clearfix">
					<div class="blog-author-image" style="background-image: url('https://cdn.v2ex.com/gravatar/90418ca09c90fa30b5fceaf7bae4ac31?s=200&d=mm&r=g');"></div>
					<div class="blog-author-title name">tangger</div>
					<div class="blog-author-title">
						æˆ‘è¿˜æ²¡æœ‰å­¦ä¼šå†™ä¸ªäººè¯´æ˜ï¼					</div>
					<a href="/author/tangger/" style="font-size: 14px">æŸ¥çœ‹â€œtanggerâ€çš„æ‰€æœ‰æ–‡ç«  â†’</a>
				</div>
			</div>
		</div>
		
<div id="comments" class="comments-area">

		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2020/08/study-notes-on-tensorflow-part2/#respond" style="display:none;">Cancel reply</a></small>
</h3>
<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p>
<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p>
<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required="required"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required="required"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200"></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes"> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="82" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p>
</form>	</div>

	
</div>	</div>
</div>


<div class="light-tint section">
	<div class="container w-container">
		<div class="section-title-wrapper">
			<h2 class="section-title">ç›¸å…³æ¨è</h2>
		</div>
		<div class="blog-list-wrapper w-dyn-list">
			<div class="blog-posts-list w-clearfix w-dyn-items w-row">
				
				
				<div class="blog-post-item w-col w-col-4 w-dyn-item">
					<a class="blog-post-image-link-block small w-inline-block" title="è®°å½•â€”â€”Docker+Tensorflow2åˆä½“éªŒ" href="/2020/10/try-to-learn-tensorflow2-on-docker/" style="background-image: url('/wp-content/uploads/2021/07/1586231988-thumb-42.jpg.pagespeed.ce_.-tW6B8qo4n.jpg');">
						<div class="blog-author-wrapper small w-clearfix">
														<div class="blog-date small">2020-10-01</div>
						</div>
					</a>
					<a class="blog-title-link" title="è®°å½•â€”â€”Docker+Tensorflow2åˆä½“éªŒ" href="/2020/10/try-to-learn-tensorflow2-on-docker/">è®°å½•â€”â€”Docker+Tensorflow2åˆä½“éªŒ</a>
				</div>

				
				<div class="blog-post-item w-col w-col-4 w-dyn-item">
					<a class="blog-post-image-link-block small w-inline-block" title="ç®€è®°â€”â€”å…¨è¿æ¥å±‚ä¸ç¥ç»ç½‘ç»œçš„ä¸¤ç§å®ç°æ–¹å¼" href="/2020/08/two-realization-methods-of-fully-connected-layer-and-neural-network/" style="background-image: url('/wp-content/uploads/2021/07/1617199381-c11.jpeg');">
						<div class="blog-author-wrapper small w-clearfix">
														<div class="blog-date small">2020-08-23</div>
						</div>
					</a>
					<a class="blog-title-link" title="ç®€è®°â€”â€”å…¨è¿æ¥å±‚ä¸ç¥ç»ç½‘ç»œçš„ä¸¤ç§å®ç°æ–¹å¼" href="/2020/08/two-realization-methods-of-fully-connected-layer-and-neural-network/">ç®€è®°â€”â€”å…¨è¿æ¥å±‚ä¸ç¥ç»ç½‘ç»œçš„ä¸¤ç§å®ç°æ–¹å¼</a>
				</div>

				
				<div class="blog-post-item w-col w-col-4 w-dyn-item">
					<a class="blog-post-image-link-block small w-inline-block" title="ç®€è®°â€”â€”Tensorflowè¿›é˜¶çŸ¥è¯†ä¸Š" href="/2020/08/study-notes-on-tensorflow-part1/" style="background-image: url('/wp-content/uploads/2021/07/1617199381-c11.jpeg');">
						<div class="blog-author-wrapper small w-clearfix">
														<div class="blog-date small">2020-08-19</div>
						</div>
					</a>
					<a class="blog-title-link" title="ç®€è®°â€”â€”Tensorflowè¿›é˜¶çŸ¥è¯†ä¸Š" href="/2020/08/study-notes-on-tensorflow-part1/">ç®€è®°â€”â€”Tensorflowè¿›é˜¶çŸ¥è¯†ä¸Š</a>
				</div>

								
			</div>
		</div>
	</div>
</div>
<div class="footer">
	<div class="container w-container">
		<div class="footer-text">
			Copyright2021. All Rights Reserved.Â 			
						
			
				Â <a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">æ¸ICPå¤‡19011860å·-2</a>

					</div>
		
		<div class="_2 footer-text">
			Powered by
			<a href="http://www.xintheme.com/" target="_blank">XinTheme</a> + 
			<a href="https://blog.wpjam.com/" target="_blank">WordPress æœé…±</a>
		</div>
		<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/prismjs@1.15.0/components/prism-core.min.js?ver=1.15.0" id="prism-js-0-js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/prismjs@1.15.0/prism.min.js?ver=1.15.0" id="prism-js-1-js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-numbers/prism-line-numbers.min.js?ver=1.15.0" id="prism-js-2-js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/autoloader/prism-autoloader.min.js?ver=1.15.0" id="prism-js-3-js"></script>
<script type="text/javascript" src="/wp-includes/js/clipboard.min.js?ver=5.7.2" id="clipboard-js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emojify.js@1.1.0/dist/js/emojify.min.js?ver=1.1.0" id="emojify-js"></script>
<script type="text/javascript" src="https://zz.bdstatic.com/linksubmit/push.js?ver=5.7.2" id="baidu_zz_push-js"></script>
 <script id="auto_loader_config_scripts"> Prism.plugins.autoloader.languages_path = "https://cdn.jsdelivr.net/npm/prismjs@1.15.0/components/"; </script>  <script id="module-prism-line-number"> (function($) { $(function() { $("code").each(function() { var parent_div = $(this).parent("pre"); var pre_css = $(this).attr("class"); if (typeof pre_css !== "undefined" && -1 !== pre_css.indexOf("language-")) { parent_div.addClass("line-numbers"); } }); }); })(jQuery); </script>  <script id="module-clipboard"> (function($) { $(function() { var pre = document.getElementsByTagName("pre"); var pasteContent = document.getElementById("paste-content"); var hasLanguage = false; for (var i = 0; i < pre.length; i++) { var codeClass = pre[i].children[0].className; var isLanguage = codeClass.indexOf("language-"); var excludedCodeClassNames = [ "language-katex", "language-seq", "language-sequence", "language-flow", "language-flowchart", "language-mermaid", ]; var isExcluded = excludedCodeClassNames.indexOf(codeClass); if (isExcluded !== -1) { isLanguage = -1; } if (isLanguage !== -1) { var button = document.createElement("button"); button.className = "copy-button"; button.textContent = "Copy"; pre[i].appendChild(button); hasLanguage = true; } }; if (hasLanguage) { var copyCode = new ClipboardJS(".copy-button", { target: function(trigger) { return trigger.previousElementSibling; } }); copyCode.on("success", function(event) { event.clearSelection(); event.trigger.textContent = "Copied"; window.setTimeout(function() { event.trigger.textContent = "Copy"; }, 2000); }); } }); })(jQuery); </script> 
			<script id="module-emojify">
				(function($) {
					$(function() {
						if (typeof emojify !== "undefined") {
							emojify.setConfig({
								img_dir: "https://cdn.jsdelivr.net/npm/emojify.js@1.1.0/dist/images/basic",
								blacklist: {
									"classes": ["no-emojify"],
									"elements": ["script", "textarea", "pre", "code"]
								}
							});
							emojify.run();
						} else {
							console.log("[wp-githuber-md] emogify is undefined.");
						}
					});
				})(jQuery);
			</script>
			</div>
</div>
<div class="gotop-wrapper">
	<a href="javascript:;" class="fixed-gotop gotop"></a>
</div>
</body>
</html>
